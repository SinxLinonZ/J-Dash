<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>J-Dash</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Fomantic UI -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/semantic.min.js"></script>

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans&family=Noto+Sans+JP&family=Noto+Sans+SC&family=Noto+Sans+TC&display=swap"
        rel="stylesheet">
</head>

<body>

    <!-- 
        TODO: 
            Bus timetable
            Open API (documentation)
     -->


    <style>
        * {
            font-family: 'Noto Sans JP', 'Noto Sans', 'Noto Sans TC', 'Noto Sans SC', sans-serif !important;
        }
    </style>

    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>

    <div id="navBar" class="ui top fixed menu">
        <a class="item">
            <img class="ui mini image" src="./img/logo.png">
        </a>
        <a class="item" onclick="$('#disclaimerModal').modal('show')">Disclaimer</a>
        <a class="item" onclick="$('#tosModal').modal('show')">ToS</a>

        <div class="right menu">
            <a class="item" onclick="$('#notificationModal').modal('show')">お知らせ</a>
        </div>

    </div>

    <div id="mainContent" class="ui container" style="padding-top: 1em;">

        <h1>J Dash</h1>
        <hr style="margin-bottom: 2em;">

        <!-- TODO: custom click link -->
        <div class="ui grid">

            <!-- Mobile & computer section -->
            <!-- Dashboard -->
            <div class="row">

                <div class="eight wide computer sixteen wide tablet sixteen wide mobile column">

                    <div class="ui piled segments" style="padding: 1em; width: 100%; margin-bottom: 1em;">
                        <div class="ui segment">
                            <!--
                            <p style="text-align: right; margin: 0; font-size: 1.2em;" id="display_studentId">
                            </p>
                            -->
                            <p style="margin: 0; font-size: 1.2em;">
                                おかえり、
                                <span style="font-size: 1.5em;" id="display_username"></span>
                                さん！
                            </p>

                            <div style="font-size: 1.2em; display: flex; align-items: center; margin: 5px 0"
                                id="display_unreadNotiCnt">
                                <div class="ui active inline small loader"></div>
                            </div>

                            <p style="text-align: right;">
                                <a id="btn_linkToJport" href="#" target="_blank" rel="noopener noreferrer">
                                    <button class="ui button secondary disabled">
                                        J-Portへ
                                    </button>
                                </a>
                                <a id="btn_linkToNotification" href="#" target="_blank" rel="noopener noreferrer">
                                    <button class="ui button secondary disabled">
                                        掲示板へ
                                    </button>
                                </a>
                            </p>

                        </div>
                    </div>
                </div>


                <div class="eight wide computer sixteen wide tablet sixteen wide mobile column">
                    <div class="ui card" style="width: 100%;">

                        <div class="content">
                            <div class="header">出席</div>
                        </div>

                        <div class="content">
                            <div id="attendForm" class="ui form">
                                <div class="ui grid middle aligned center aligned">
                                    <div class="row" style="font-size: 2em;">

                                        <div class="ten wide column">
                                            <div class="field">
                                                <input id="input_attendCode" type="number" placeholder="出席コード"
                                                    pattern="[0-9]*" inputmode="numeric"
                                                    oninput="javascript:if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                                                    maxlength="4">
                                            </div>
                                        </div>

                                        <div class="six wide column">
                                            <button id="btn_attend" class="ui button disabled"
                                                style="width: 100%; font-size: 1.1em; padding-left: .2em; padding-right: .2em;">出席</button>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>







            <!-- Mobile section -->
            <!-- Time table -->
            <div class="row tablet mobile only">
                <div class="sixteen wide column">
                    <h2 id="mobileTimetableTitle"></h2>
                    <hr>
                </div>

                <div class="sixteen wide column" id="mobileTimetable">
                    <!-- Lecture info will be filled here -->
                </div>
            </div>



            <!-- Computer section -->
            <!-- Time table -->
            <div class="row computer only">

                <div class="left ui rail very close" style="text-align: right;">
                    <button id="btn_changeTableMode" class="ui icon button" data-tooltip="時間割表の表示切り替え" data-inverted="">
                        <i class="retweet icon" style="font-family: Icons !important;"></i>
                    </button>
                </div>


                <table id="PCTimeTable" class="ui definition table celled fixed" style="margin: 0;">
                    <thead>
                        <tr class="center aligned">
                            <th style="width: 5%"></th>
                            <th>一限<br>09:15 ~ 10:45</th>
                            <th>二限<br>10:55 ~ 12:25</th>
                            <th>三限<br>13:10 ~ 14:40</th>
                            <th>四限<br>14:50 ~ 16:20</th>
                            <th>五限<br>16:30 ~ 18:00</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td height="100px" width="5%" class="center aligned">月</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td height="100px" width="5%" class="center aligned">火</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td height="100px" width="5%" class="center aligned">水</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td height="100px" width="5%" class="center aligned">木</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td height="100px" width="5%" class="center aligned">金</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                    </tbody>
                </table>
            </div>

        </div>






        <div class="ui section divider" style="margin-bottom: 1em;"></div>
        <p style="padding-bottom: 2em; text-align: right;">Powered by NetTech / NSS (J19478)</p>
    </div>




    <!-- Syllabus modal -->
    <!--
    <div id="syllabusModal" class="ui modal">
        <div class="center aligned header">シラバス照会</div>

        <div class="center aligned content">
        </div>

        <div class="center aligned actions">
            <div class="ui positive button">OK</div>
        </div>
    </div>
    -->


    <!-- Notification -->
    <div id="notificationModal" class="ui modal">
        <div class="center aligned header">お知らせ / Notification / 系统通知</div>

        <div class="content">
            <div class="ui pointing secondary menu">
                <a class="item active" data-tab="notification-japanese">日本語</a>
                <a class="item" data-tab="notification-english">English</a>
                <a class="item" data-tab="notification-traditionalChinese">中文（繁体）</a>
                <a class="item" data-tab="notification-simplifiedChinese">中文（简体）</a>
            </div>

            <div class="ui tab active" data-tab="notification-japanese">
            </div>

            <div class="ui tab" data-tab="notification-english">
            </div>

            <div class="ui tab" data-tab="notification-traditionalChinese">
            </div>

            <div class="ui tab" data-tab="notification-simplifiedChinese">
            </div>

        </div>

        <div class="center aligned actions">
            <div class="ui positive button" onclick="if (!loginData) {$('#loginModal').modal('show');}">OK</div>
        </div>
    </div>


    <!-- Disclaimer -->
    <div id="disclaimerModal" class="ui modal">
        <div class="center aligned header">免責事項 / Disclaimer / 免责声明</div>

        <div class="content">
            <div class="ui pointing secondary menu">
                <a class="item active" data-tab="disclaimer-japanese">日本語</a>
                <a class="item" data-tab="disclaimer-english">English</a>
                <a class="item" data-tab="disclaimer-traditionalChinese">中文（繁体）</a>
                <a class="item" data-tab="disclaimer-simplifiedChinese">中文（简体）</a>
            </div>

            <div class="ui tab active" data-tab="disclaimer-japanese">
                <p></p>
            </div>

            <div class="ui tab" data-tab="disclaimer-english">
                <p></p>
            </div>

            <div class="ui tab" data-tab="disclaimer-traditionalChinese">
                <p></p>
            </div>

            <div class="ui tab" data-tab="disclaimer-simplifiedChinese">
                <p></p>
            </div>

        </div>

        <div class="center aligned actions">
            <div class="ui positive button"
                onclick="if (!loginData) {$('#loginModal').modal({ closable: false }).modal('show');}">OK</div>
        </div>
    </div>

    <!-- Terms of service -->
    <div id="tosModal" class="ui modal">
        <div class="center aligned header">利用規約 / Terms of service / 服务条款</div>

        <div class="content">
            <div class="ui pointing secondary menu">
                <a class="item active" data-tab="ToS-japanese">日本語</a>
                <a class="item" data-tab="ToS-english">English</a>
                <a class="item" data-tab="ToS-traditionalChinese">中文（繁体）</a>
                <a class="item" data-tab="ToS-simplifiedChinese">中文（简体）</a>
            </div>

            <div class="ui tab active" data-tab="ToS-japanese">
                <p></p>
            </div>

            <div class="ui tab" data-tab="ToS-english">
                <p></p>
            </div>

            <div class="ui tab" data-tab="ToS-traditionalChinese">
                <p></p>
            </div>

            <div class="ui tab" data-tab="ToS-simplifiedChinese">
                <p></p>
            </div>

        </div>

        <div class="center aligned actions">
            <div class="ui positive button"
                onclick="if (!loginData) {$('#disclaimerModal').modal({ closable: false }).modal('show');}">OK</div>
        </div>
    </div>


    <script>$('.menu .item').tab()</script>


    <!-- Attend screenshot modal -->
    <div id="attendResult" class="ui modal">
        <div class="center aligned header">出席結果</div>

        <div class="center aligned content">
            <img src="" alt="出席スクリーンショット" style="max-width: 100%; cursor: zoom-in;"></img>
            <span style="color: gray;">クリック・タッチすると拡大できます</span>
        </div>

        <div class="center aligned actions">
            <div class="ui positive button">OK</div>
        </div>
    </div>

    <!-- First use login modal -->
    <div id="loginModal" class="ui modal">
        <div class="center aligned header">初回登録</div>


        <div class="center aligned content">
            <div class="ui grid centered">
                <div class="center aligned sixteen wide mobile eight wide tablet four wide computer column">

                    <div class="ui form">
                        <div class="field">
                            <label>User ID</label>
                            <input id="loginUsername" type="text" placeholder="jxxxxxaa">
                        </div>
                        <div class="field">
                            <label>Password</label>
                            <input id="loginPassword" type="password" placeholder="password">
                        </div>
                        <button class="ui button primary" id="loginButton">Login</button>
                    </div>

                </div>
            </div>

            <br>
            <span style="color: rgb(170, 170, 170);">＊ログイン情報はローカルにて保存されています</span>
        </div>

        <!--         
        <div class="center aligned actions">
            <div class="ui negative button">Cancel</div>
            <div class="ui positive button">OK</div>
        </div>
        -->
    </div>



    <!-- --------------------------------------------------------------------------------------- -->



    <script>
        let loginData;

        $(document).ready(function () {

            /*****************
             * Text fetch
             */
            const LANG = ["english", "japanese", "traditionalChinese", "simplifiedChinese"];
            for (let i = 0; i < LANG.length; i++) {
                $.get(`plain/disclaimer/${LANG[i]}.txt`, function (data) {
                    $(`#disclaimerModal .ui.tab[data-tab="disclaimer-${LANG[i]}"]`).html(data.replace(/\n/g, "<br>"));
                });

                $.get(`plain/ToS/${LANG[i]}.txt`, function (data) {
                    $(`#tosModal .ui.tab[data-tab="ToS-${LANG[i]}"]`).html(data.replace(/\n/g, "<br>"));
                });

                $.get(`plain/notification/${LANG[i]}.txt`, function (data) {
                    $(`#notificationModal .ui.tab[data-tab="notification-${LANG[i]}"]`).html(data.replace(/\n/g, "<br>"));
                });
                
            }


            /*****************
             * Event listener
             */

            // Attendance input
            // enable button only when input is 4 digits
            // shortcut Enter key to click button
            $('#input_attendCode').on('keyup', function (e) {
                if (e.keyCode === 13) {
                    $('#btn_attend').click();
                }

                if ($('#input_attendCode').val().length === 4) {
                    $('#btn_attend').removeClass('disabled');
                    $('#btn_attend').addClass('positive');
                } else {
                    $('#btn_attend').removeClass('positive');
                    $('#btn_attend').addClass('disabled');
                }
            });

            // Attendance input
            // only allowed number digit input
            $('#input_attendCode').on('keydown', function (e) {
                // only number 0-9, enter and backspace allowed
                if ((e.keyCode < 48 || e.keyCode > 57) && (e.keyCode < 96 && e.keyCode > 105) && e.keyCode !== 8 && e.keyCode !== 13) {
                    e.preventDefault();
                }
            });

            // Attendance button
            $('#btn_attend').click(() => {
                if ($('#attendForm').hasClass('loading') || $('#btn_attend').hasClass('disabled')) {
                    return;
                }

                const code = $('#input_attendCode').val();

                if (code.length != 4) {
                    $('body').toast({
                        message: '出席コードは4桁で入力してください。',
                        class: 'error',
                        // position: 'top right',
                        // displayTime: 3000
                    });
                    return;
                }

                $('#attendForm').addClass('loading');
                $('#btn_attend').removeClass('positive');
                $('#btn_attend').addClass('disabled');

                AJAX(APIEndpoint.attendance, 'POST',
                    {
                        username: loginData.username,
                        password: loginData.password,
                        code: code
                    },
                    function (data) {
                        let src = "data:image/png;base64, " + data;
                        $('#attendResult img').attr('src', src);

                        $('#attendResult').modal({
                            closable: false,
                        }).modal('show');

                        $('#input_attendCode').val('');
                        $('#attendForm').removeClass('loading');
                        $('#btn_attend').removeClass('positive');
                        $('#btn_attend').addClass('disabled');
                    },
                    function (data) {
                        $('body').toast({
                            message: '不明エラーです、J-Portを利用してください',
                            class: 'error',
                        });

                        $('#attendForm').removeClass('loading');
                        $('#btn_attend').removeClass('positive');
                        $('#btn_attend').addClass('disabled');
                    }
                );

            });

            // Attendance result image
            // open new window to display full size screenshot
            $('#attendResult img').click(() => {
                const win = window.open();
                win.document.write('<iframe src="' + $('#attendResult img').attr('src') + '" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>');
                win.document.close();
            });

            // Login input
            $('#loginUsername').on('keyup', function (e) {
                if (e.keyCode === 13) {
                    $('#loginPassword').focus();
                }
            });
            $('#loginPassword').on('keyup', function (e) {
                if (e.keyCode === 13) {
                    $('#loginButton').click();
                }
            });

            $('#loginButton').click(() => {
                const username = $('#loginUsername').val();
                const password = $('#loginPassword').val();

                // Empty input
                if (username.length == 0 || password.length == 0) {
                    $('body').toast({
                        class: 'error',
                        message: `ユーザーIDとパスワードを入力してください。`,
                    });
                    return;
                }


                // Get encrypted password
                AJAX(APIEndpoint.login, 'POST',
                    {
                        username: username,
                        password: password,
                        URIEncode: true
                    },
                    function (data) {
                        if (!data) {
                            $('body').toast({
                                class: 'error',
                                message: `ユーザーIDまたはパスワードが間違っています。`,
                            });
                            return;
                        }

                        COOKIE.SetUserData(username, data.encryptedPassword, data);
                        $('#loginModal').modal('hide');
                        Init();
                    },
                    function (data) {
                        $('body').toast({
                            class: 'error',
                            message: `不明エラーです、J-Portを利用してください`,
                        });
                    }
                );
            });

            // Button to change table display mode
            $('#btn_changeTableMode').click(PCInvertTableDisplay);



            /*****************
             * Post check
             */
            let cookie = document.cookie;

            // First use
            if (cookie.indexOf("username=") == -1 || cookie.indexOf("password=") == -1 || cookie.indexOf("origin=") == -1) {

                $('#tosModal').modal({ closable: false }).modal('show');
                // $('#disclaimerModal').modal({ closable: false }).modal('show');

                // Show login modal
                // $('#loginModal').modal({ closable: false }).modal('show');
            }

            // parse login data from cache
            else {
                Init();
            }
        });



        function Init() {
            // Update Cookie expiration
            loginData = COOKIE.ToJSON();
            COOKIE.UpdateExpires();

            /*******
             * UI Rendering
             */
            RenderUserData();
            RenderUserDataAjax();
            $('#mainContent').css('padding-top', ($('#navBar').height() + 10) + 'px');


            // $.ajax({
            //     url: 'api/lectureStatus',
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     data: JSON.stringify({
            //         username: loginData.username,
            //         password: loginData.password,
            //     }),

            //     success: function (data) {
            //         if (!data) {
            //             $('body').toast({
            //                 class: 'error',
            //                 message: `ユーザーIDまたはパスワードが間違っています。`,
            //             });
            //             return;
            //         }

            //         $('#lectureStatus').text(JSON.stringify(data, null, 2));
            //     },
            // });

        }


        /*****************
         * Network utils
         */
        const APIEndpoint = {
            login: 'api/login',
            schedule: 'api/schedule',
            lectureStatus: 'api/lectureStatus',
            homeUrl: 'api/homeUrl',
            attendance: 'api/attendance',
            lectureSyllabus: 'api/lectureSyllabus',
            notificationUrl: 'api/notification/url',
            unreadNotificationCount: 'api/notification/unreadCount',
        };

        function AJAX(url, method, data, success, error) {
            $.ajax({
                url: url,
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                data: JSON.stringify(data),

                success: success,
                error: error,
            });
        }



        /*****************
         * Display utils
         */

        function RenderUserData() {
            $('#display_username').text(loginData.origin.name);
            // $('#display_studentId').text(loginData.origin.gaksekiCd);
        }

        function RenderUserDataAjax() {
            // Get schedule data & render
            AJAX(APIEndpoint.schedule, 'POST',
                {
                    username: loginData.username,
                    password: loginData.password,
                },
                function (data) {
                    if (!data) {
                        $('body').toast({
                            class: 'error',
                            message: `ユーザーIDまたはパスワードが間違っています。`,
                        });
                        return;
                    }

                    // Set schedule
                    setPCTimetableTitle(data.term + '<br>' + data.termDisplayName);
                    clearPCTimetable();
                    PCAddLectureList(data.schedule);
                    if (loginData.settings.pcTimetableInverted) {
                        PCInvertTableDisplay();
                    }

                    setMobileTimetableTitle(data.term + ' / ' + data.termDisplayName);
                    clearMobileTimetable();
                    MobileAddLectureList(data.schedule);
                },
            );

            // Init external link button
            AJAX(APIEndpoint.homeUrl, 'POST',
                {
                    username: loginData.username,
                    password: loginData.password,
                },
                function (data) {
                    if (!data) {
                        $('body').toast({
                            class: 'error',
                            message: `ユーザーIDまたはパスワードが間違っています。`,
                        });
                        return;
                    }

                    $('#btn_linkToJport').attr('href', data);
                    $('#btn_linkToJport > button').removeClass('disabled');
                }
            );
            AJAX(APIEndpoint.notificationUrl, 'POST',
                {
                    username: loginData.username,
                    password: loginData.password,
                },
                function (data) {
                    if (!data) {
                        $('body').toast({
                            class: 'error',
                            message: `ユーザーIDまたはパスワードが間違っています。`,
                        });
                        return;
                    }

                    $('#btn_linkToNotification').attr('href', data);
                    $('#btn_linkToNotification > button').removeClass('disabled');
                }
            );

            // Get unread notification count
            AJAX(APIEndpoint.unreadNotificationCount, 'POST',
                {
                    username: loginData.username,
                    password: loginData.password,
                },
                function (data) {
                    $('#display_unreadNotiCnt').html(`<span class="ui label" style="margin-right: 5px">${data}</span>未読お知らせ`);
                    if (data == 'err') {
                        $('#display_unreadNotiCnt > span').addClass('red');
                    }
                    else if (data > 0) {
                        $('#display_unreadNotiCnt > span').addClass('orange');
                    }
                }
            );
        }





        /*****************
         * Timetable utils
         */

        /* Mobile */
        function clearMobileTimetable() {
            $('#mobileTimetable').empty();
        }

        function setMobileTimetableTitle(title) {
            $('#mobileTimetableTitle').html(title);
        }

        function MobileAddLectureList(lectureList) {
            let day = ['月曜日', '火曜日', '水曜日', '木曜日', '金曜日'];
            let lectureTime = {
                1: {
                    start: "09:15",
                    end: "10:45"
                },
                2: {
                    start: "10:55",
                    end: "12:25"
                },
                3: {
                    start: "13:10",
                    end: "14:40"
                },
                4: {
                    start: "14:50",
                    end: "16:20"
                },
                5: {
                    start: "16:30",
                    end: "18:00"
                }
            }

            let sorted = {};
            for (const lecture of lectureList) {
                if (!sorted[lecture.kaikoYobi]) {
                    sorted[lecture.kaikoYobi] = [lecture];
                } else {
                    sorted[lecture.kaikoYobi].push(lecture);
                }
            }

            let html = '';

            for (const key in sorted) {

                if (key == 0) {
                    // TODO: syuu cyuu kou gi
                    continue;
                }

                html += `<h3 style="color: gray;">${day[key - 1]}</h3>`;
                html += '<div class="ui segments">';

                for (const lecture of sorted[key]) {
                    let segment = '';

                    segment += `<div class="ui segment" onclick="showSyllabus(${JSON.stringify(lecture).replace(/"/g, '\'')})">`;
                    segment += '<div class="ui two column grid middle aligned">';
                    segment += '<div class="row">';

                    segment += '<div class="column">';
                    segment += `<p style="margin: 0;">${lecture.jugyoName}</p>`;
                    segment += `<p style="margin: 0; color: gray">${lecture.kyostName}</p>`;
                    segment += '</div>';

                    segment += '<div class="column right aligned">';
                    segment +=
                        `<div
                            style="display: inline; color: white; background-color: rgb(0, 69, 58); padding: 5px 10px;">
                            ${lectureTime[lecture.jigenNo].start}
                        </div>
                        <div
                            style="display: inline; color: white; background-color: rgb(3, 117, 98); padding: 5px 10px;">
                            ${lectureTime[lecture.jigenNo].end}
                        </div>
                        `;
                    segment += '</div>';


                    segment += '</div>';
                    segment += '</div>';
                    segment += '</div>';

                    html += segment;


                }

                html += '</div>';

                $('#mobileTimetable').html(html);
            }
        }


        /* PC */
        function setPCTimetableTitle(title) {
            $('#PCTimeTable > thead > tr > th:nth-child(1)').html(title);
        }

        function clearPCTimetable() {
            let rows = $('#PCTimeTable > tbody > tr');

            for (let row of rows) {
                let cols = row.children;

                for (let i = 1; i < cols.length; i++) {
                    cols[i].innerText = '';
                    cols[i].setAttribute('style', '');
                    cols[i].setAttribute('onmouseover', '');
                    cols[i].setAttribute('onmouseout', '');
                    cols[i].setAttribute('onclick', '');
                }
            }
        }

        function PCAddLectureList(lectureList) {
            for (const lecture of lectureList) {
                PCAddLecture(lecture);
            }
        }

        function PCAddLecture(lecture) {
            const lectureName = lecture.jugyoName;
            const day = lecture.kaikoYobi;
            const period = lecture.jigenNo;

            const teacherName = lecture.kyoinName;
            const lectureRoom = lecture.kyostName;

            const unreadNotification = lecture.keijiMidokCnt;

            if (day == 0 && period == 0) {
                // TODO: syuu cyuu kou gi
            }
            else {
                let cell = $(`#PCTimeTable > tbody > tr:nth-child(${day}) > td:nth-child(${period + 1})`);

                cell.html(
                    `<p style="margin: 0; font-weight: bold">${lectureName}</p>
                        <p style="margin: 0; text-align: right; color: gray">${teacherName}</p>
                        <p style="margin: 0; text-align: right; color: gray">${lectureRoom}</p>
                        `);

                cell.attr('style', 'cursor: pointer;');
                cell.attr('onmouseover', `$(this).css('background-color', '#f5f5f5')`);
                cell.attr('onmouseout', `$(this).css('background-color', '#ffffff')`);
                cell.attr('onclick', `showSyllabus(${JSON.stringify(lecture)})`);

                // Get lecture status
                // AJAX(APIEndpoint.lectureStatus, 'POST',
                //     {
                //         username: loginData.username,
                //         password: loginData.password,
                //         lecture, lecture
                //     },
                //     function (data) {
                //         cell.append(``);
                //     }
                // )

                // <span class="ui label">${unreadNotification}</span>
            }
        }

        function PCInvertTableDisplay() {
            // swap title
            for (let i = 1; i <= 5; i++) {
                let titleRol = $(`#PCTimeTable > thead > tr:nth-child(1) > th:nth-child(${i + 1})`);
                let titleCol = $(`#PCTimeTable > tbody > tr:nth-child(${i}) > td:nth-child(1)`);
                let tmp = titleRol.html();
                titleRol.html(titleCol.html());
                titleCol.html(tmp);
            }

            // change width
            if ($(`#PCTimeTable > thead > tr:nth-child(1) > th:nth-child(2)`).text().indexOf('月') != -1) {
                $(`#PCTimeTable > thead > tr > th:nth-child(1)`).css('width', '12%');
                COOKIE.UpdateUserSettings('pcTimetableInverted', true);
            } else {
                $(`#PCTimeTable > thead > tr > th:nth-child(1)`).css('width', '5%');
                COOKIE.UpdateUserSettings('pcTimetableInverted', false);
            }

            for (let r = 1; r < 5; r++) {
                for (let i = r; i < 5; i++) {
                    let cell1 = $(`#PCTimeTable > tbody > tr:nth-child(${r}) > td:nth-child(${i + 2})`);
                    let cell2 = $(`#PCTimeTable > tbody > tr:nth-child(${i + 1}) > td:nth-child(${r + 1})`);
                    let tmp = cell1.prop('outerHTML');
                    cell1.prop('outerHTML', cell2.prop('outerHTML'));
                    cell2.prop('outerHTML', tmp);
                }
            }
        }

        /*****************
         * Runtime event call function
         */
        function showSyllabus(lecture) {

            // $('#syllabusModal .center.aligned.content').html(
            //     `<div class="ui segment" style="height: 100px">
            //         <div class="ui active dimmer">
            //             <div class="ui text loader">Loading</div>
            //         </div>
            //         <p></p>
            //     </div>`
            // )
            // $('#syllabusModal').modal({
            //     closable: false,
            // }).modal('show');

            AJAX(APIEndpoint.lectureSyllabus, 'POST',
                {
                    username: loginData.username,
                    password: loginData.password,
                    lecture: lecture
                },
                function (data) {
                    window.open(data, '_blank').focus();
                }
            );
        }



        /*****************
         * Cookie utils
         */
        const COOKIE = {
            // Return current cookie data as JSON
            ToJSON: function () {
                let cookie = document.cookie;
                let res = {};

                cookie.split(/\s*;\s*/).forEach(function (pair) {
                    pair = pair.split(/\s*=\s*/);
                    res[pair[0]] = pair.splice(1).join('=');
                });

                res.origin = JSON.parse(decodeURIComponent(res.origin));
                res.settings = JSON.parse(decodeURIComponent(res.settings));
                return res;
            },

            SetUserData: function (username, password, origin) {
                let expires = new Date();
                expires.setTime(expires.getTime() + (10 * 24 * 60 * 60 * 1000));

                document.cookie = `username=${username}; expires=${expires.toUTCString()}; path=/;`;
                document.cookie = `password=${password}; expires=${expires.toUTCString()}; path=/;`;
                document.cookie = `origin=${encodeURIComponent(JSON.stringify(origin))}; expires=${expires.toUTCString()}; path=/;`;

                document.cookie = `settings=${encodeURIComponent(JSON.stringify({}))}; expires=${expires.toUTCString()}; path=/;`;
            },

            // Renew cookie expiration. 
            // will be called every time user login.
            UpdateExpires: function () {
                let expires = new Date();
                expires.setTime(expires.getTime() + (10 * 24 * 60 * 60 * 1000));

                let cookie = COOKIE.ToJSON();
                document.cookie = `username=${cookie.username}; expires=${expires.toUTCString()}; path=/;`;
                document.cookie = `password=${cookie.password}; expires=${expires.toUTCString()}; path=/;`;
                document.cookie = `origin=${encodeURIComponent(JSON.stringify(cookie.origin))}; expires=${expires.toUTCString()}; path=/;`;

                document.cookie = `settings=${encodeURIComponent(JSON.stringify(cookie.settings))}; expires=${expires.toUTCString()}; path=/;`;
            },

            UpdateUserSettings: function (key, value) {
                let cookie = COOKIE.ToJSON();
                cookie.settings[key] = value;
                document.cookie = `settings=${encodeURIComponent(JSON.stringify(cookie.settings))}; path=/;`;

                loginData = this.ToJSON();
            },
        }


    </script>

</body>

</html>